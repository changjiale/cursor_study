# Map è¯¦è§£

## 1. åŸºç¡€æ¦‚å¿µ

### 1.1 Mapå®šä¹‰å’Œä½œç”¨
Mapæ˜¯Goè¯­è¨€ä¸­çš„å“ˆå¸Œè¡¨å®ç°ï¼Œæä¾›é”®å€¼å¯¹çš„å­˜å‚¨å’ŒæŸ¥æ‰¾åŠŸèƒ½ã€‚Mapæ˜¯å¼•ç”¨ç±»å‹ï¼Œé›¶å€¼ä¸ºnilï¼Œéœ€è¦åˆå§‹åŒ–åæ‰èƒ½ä½¿ç”¨ã€‚

**æ ¸å¿ƒç‰¹æ€§ï¼š**
- **é”®å€¼å¯¹å­˜å‚¨**ï¼šæ”¯æŒä»»æ„å¯æ¯”è¾ƒç±»å‹ä½œä¸ºé”®
- **å“ˆå¸ŒæŸ¥æ‰¾**ï¼šO(1)å¹³å‡æ—¶é—´å¤æ‚åº¦
- **åŠ¨æ€æ‰©å®¹**ï¼šè‡ªåŠ¨å¤„ç†å“ˆå¸Œå†²çªå’Œå®¹é‡å¢é•¿
- **éçº¿ç¨‹å®‰å…¨**ï¼šå¹¶å‘è®¿é—®éœ€è¦é¢å¤–åŒæ­¥

### 1.2 ä¸å…¶ä»–æ•°æ®ç»“æ„çš„å¯¹æ¯”
- **Map vs Slice**ï¼šMapæä¾›é”®å€¼å¯¹æŸ¥æ‰¾ï¼ŒSliceæä¾›ç´¢å¼•è®¿é—®
- **Map vs Array**ï¼šMapåŠ¨æ€å¤§å°ï¼ŒArrayå›ºå®šå¤§å°
- **Map vs Struct**ï¼šMapé”®å€¼å¯¹çµæ´»ï¼ŒStructå­—æ®µå›ºå®š

## 2. æ ¸å¿ƒæ•°æ®ç»“æ„

### 2.1 hmapç»“æ„ä½“ - æ ¸å¿ƒå®šä¹‰
```go
type hmap struct {
    // ğŸ”¥ æ ¸å¿ƒè°ƒåº¦å­—æ®µ - é¢è¯•é‡ç‚¹
    count     int    // mapä¸­çš„å…ƒç´ ä¸ªæ•°
    flags     uint8  // çŠ¶æ€æ ‡å¿—
    B         uint8  // å¯ä»¥å®¹çº³2^Bä¸ªå…ƒç´ 
    noverflow uint16 // æº¢å‡ºæ¡¶çš„æ•°é‡
    
    // ğŸ”¥ å†…å­˜ç®¡ç†å­—æ®µ - å†…å­˜ç®¡ç†é‡ç‚¹
    hash0     uint32 // hashç§å­
    buckets    unsafe.Pointer // æŒ‡å‘2^Bä¸ªæ¡¶çš„æ•°ç»„
    oldbuckets unsafe.Pointer // æ‰©å®¹æ—¶æŒ‡å‘æ—§æ¡¶æ•°ç»„
    
    // ğŸ”¥ æ€§èƒ½ä¼˜åŒ–å­—æ®µ - æ€§èƒ½ä¼˜åŒ–é‡ç‚¹
    nevacuate  uintptr        // æ‰©å®¹è¿›åº¦è®¡æ•°å™¨
    extra     *mapextra       // æº¢å‡ºæ¡¶ä¿¡æ¯
}

// ä½œç”¨ï¼šMapçš„æ ¸å¿ƒæ•°æ®ç»“æ„ï¼Œç®¡ç†å“ˆå¸Œè¡¨çš„æ‰€æœ‰ä¿¡æ¯
// è®¾è®¡æ€æƒ³ï¼šåˆ†ç¦»å¼é“¾è¡¨æ³•å¤„ç†å“ˆå¸Œå†²çªï¼Œå¢é‡æ‰©å®¹ä¼˜åŒ–æ€§èƒ½
// é¢è¯•é‡ç‚¹ï¼š
// 1. å“ˆå¸Œå†²çªçš„è§£å†³æ–¹å¼
// 2. æ‰©å®¹æœºåˆ¶çš„è®¾è®¡
// 3. å†…å­˜å¸ƒå±€çš„ä¼˜åŒ–
```

### 2.2 bmapç»“æ„ä½“ - æ¡¶ç»“æ„
```go
type bmap struct {
    // ğŸ”¥ æ ¸å¿ƒè°ƒåº¦å­—æ®µ - é¢è¯•é‡ç‚¹
    tophash [8]uint8 // é«˜8ä½hashå€¼ï¼Œç”¨äºå¿«é€Ÿæ¯”è¾ƒ
    
    // ä»¥ä¸‹å­—æ®µåœ¨ç¼–è¯‘æ—¶ç¡®å®šï¼Œè¿è¡Œæ—¶é€šè¿‡æŒ‡é’ˆåç§»è®¿é—®
    // keys    [8]keytype   // 8ä¸ªkey
    // values  [8]valuetype // 8ä¸ªvalue
    // overflow *bmap       // æº¢å‡ºæ¡¶æŒ‡é’ˆ
}

// ä½œç”¨ï¼šå­˜å‚¨é”®å€¼å¯¹çš„åŸºæœ¬å•å…ƒï¼Œæ¯ä¸ªæ¡¶æœ€å¤š8ä¸ªå…ƒç´ 
// è®¾è®¡æ€æƒ³ï¼šç´§å‡‘å­˜å‚¨ï¼Œå‡å°‘å†…å­˜è®¿é—®ï¼Œæé«˜ç¼“å­˜å‘½ä¸­ç‡
// é¢è¯•é‡ç‚¹ï¼š
// 1. æ¡¶çš„è®¾è®¡å’Œå®¹é‡é€‰æ‹©
// 2. æº¢å‡ºæ¡¶çš„é“¾æ¥æ–¹å¼
// 3. å†…å­˜å¸ƒå±€çš„ä¼˜åŒ–
```

### 2.3 mapextraç»“æ„ä½“ - æº¢å‡ºæ¡¶ç®¡ç†
```go
type mapextra struct {
    // ğŸ”¥ å†…å­˜ç®¡ç†å­—æ®µ - å†…å­˜ç®¡ç†é‡ç‚¹
    overflow    *[]*bmap // æº¢å‡ºæ¡¶æ•°ç»„
    oldoverflow *[]*bmap // æ—§æº¢å‡ºæ¡¶æ•°ç»„
    
    // ğŸ”¥ æ€§èƒ½ä¼˜åŒ–å­—æ®µ - æ€§èƒ½ä¼˜åŒ–é‡ç‚¹
    nextOverflow *bmap // ä¸‹ä¸€ä¸ªå¯ç”¨çš„æº¢å‡ºæ¡¶
}

// ä½œç”¨ï¼šç®¡ç†æº¢å‡ºæ¡¶ï¼Œæ”¯æŒæ‰©å®¹æ—¶çš„å†…å­˜ç®¡ç†
// è®¾è®¡æ€æƒ³ï¼šé¢„åˆ†é…æº¢å‡ºæ¡¶ï¼Œå‡å°‘è¿è¡Œæ—¶åˆ†é…
// é¢è¯•é‡ç‚¹ï¼š
// 1. æº¢å‡ºæ¡¶çš„åˆ†é…ç­–ç•¥
// 2. æ‰©å®¹æ—¶çš„å†…å­˜ç®¡ç†
// 3. æ€§èƒ½ä¼˜åŒ–çš„è€ƒè™‘
```

## 3. é‡ç‚¹å­—æ®µæ·±åº¦è§£æ

### 3.1 ğŸ”¥ æ ¸å¿ƒè°ƒåº¦å­—æ®µ
#### `count int` - å…ƒç´ è®¡æ•°
```go
// ä½œç”¨ï¼šè®°å½•Mapä¸­å½“å‰å…ƒç´ çš„æ•°é‡
// è®¾è®¡æ€æƒ³ï¼šåŸå­æ“ä½œä¿è¯å¹¶å‘å®‰å…¨ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹
// é¢è¯•é‡ç‚¹ï¼š
// 1. æ‰©å®¹è§¦å‘æ¡ä»¶ï¼šcount > 2^B * 6.5
// 2. å¹¶å‘å®‰å…¨çš„ä¿è¯
// 3. æ€§èƒ½ä¼˜åŒ–çš„è€ƒè™‘
```

#### `B uint8` - æ¡¶æ•°é‡æŒ‡æ•°
```go
// ä½œç”¨ï¼šæ¡¶çš„æ•°é‡ä¸º2^Bï¼Œå†³å®šMapçš„å®¹é‡
// è®¾è®¡æ€æƒ³ï¼šä½¿ç”¨æŒ‡æ•°å½¢å¼ï¼Œä¾¿äºä½è¿ç®—ä¼˜åŒ–
// é¢è¯•é‡ç‚¹ï¼š
// 1. å®¹é‡è®¡ç®—ï¼š2^B * 8ï¼ˆæ¯ä¸ªæ¡¶8ä¸ªå…ƒç´ ï¼‰
// 2. æ‰©å®¹æ—¶çš„Bå€¼å˜åŒ–
// 3. å“ˆå¸Œå€¼æ˜ å°„åˆ°æ¡¶çš„ç®—æ³•
```

#### `buckets unsafe.Pointer` - æ¡¶æ•°ç»„æŒ‡é’ˆ
```go
// ä½œç”¨ï¼šæŒ‡å‘å½“å‰ä½¿ç”¨çš„æ¡¶æ•°ç»„
// è®¾è®¡æ€æƒ³ï¼šä½¿ç”¨unsafe.Pointeré¿å…ç±»å‹æ£€æŸ¥å¼€é”€
// é¢è¯•é‡ç‚¹ï¼š
// 1. æ¡¶æ•°ç»„çš„å†…å­˜å¸ƒå±€
// 2. å“ˆå¸Œå€¼åˆ°æ¡¶ç´¢å¼•çš„æ˜ å°„
// 3. æ‰©å®¹æ—¶çš„æŒ‡é’ˆåˆ‡æ¢
```

### 3.2 ğŸ”¥ å†…å­˜ç®¡ç†å­—æ®µ
#### `hash0 uint32` - å“ˆå¸Œç§å­
```go
// ä½œç”¨ï¼šä¸ºå“ˆå¸Œå‡½æ•°æä¾›éšæœºç§å­ï¼Œé˜²æ­¢å“ˆå¸Œæ”»å‡»
// è®¾è®¡æ€æƒ³ï¼šæ¯æ¬¡åˆ›å»ºMapæ—¶éšæœºç”Ÿæˆï¼Œæé«˜å®‰å…¨æ€§
// é¢è¯•é‡ç‚¹ï¼š
// 1. é˜²æ­¢å“ˆå¸Œå†²çªæ”»å‡»
// 2. å“ˆå¸Œå‡½æ•°çš„éšæœºæ€§
// 3. æ€§èƒ½å’Œå®‰å…¨æ€§çš„å¹³è¡¡
```

#### `oldbuckets unsafe.Pointer` - æ—§æ¡¶æ•°ç»„
```go
// ä½œç”¨ï¼šæ‰©å®¹æ—¶ä¿å­˜æ—§æ¡¶æ•°ç»„ï¼Œæ”¯æŒå¢é‡è¿ç§»
// è®¾è®¡æ€æƒ³ï¼šå¢é‡æ‰©å®¹ï¼Œé¿å…ä¸€æ¬¡æ€§å¤§å†…å­˜åˆ†é…
// é¢è¯•é‡ç‚¹ï¼š
// 1. å¢é‡æ‰©å®¹çš„å®ç°
// 2. å†…å­˜ä½¿ç”¨çš„æœ€ä¼˜åŒ–
// 3. æ‰©å®¹è¿‡ç¨‹ä¸­çš„è®¿é—®ä¿è¯
```

### 3.3 ğŸ”¥ å¹¶å‘æ§åˆ¶å­—æ®µ
#### `flags uint8` - çŠ¶æ€æ ‡å¿—
```go
// ä½œç”¨ï¼šè®°å½•Mapçš„çŠ¶æ€ï¼Œå¦‚æ˜¯å¦æ­£åœ¨æ‰©å®¹ã€è¿­ä»£ç­‰
// è®¾è®¡æ€æƒ³ï¼šä½¿ç”¨ä½æ ‡å¿—ï¼ŒèŠ‚çœå†…å­˜ç©ºé—´
// é¢è¯•é‡ç‚¹ï¼š
// 1. å¹¶å‘å®‰å…¨çš„ä¿è¯
// 2. çŠ¶æ€æ£€æŸ¥çš„æ€§èƒ½
// 3. æ ‡å¿—ä½çš„è®¾è®¡
```

### 3.4 ğŸ”¥ æ€§èƒ½ä¼˜åŒ–å­—æ®µ
#### `nevacuate uintptr` - æ‰©å®¹è¿›åº¦
```go
// ä½œç”¨ï¼šè®°å½•æ‰©å®¹è¿›åº¦ï¼Œæ”¯æŒå¢é‡è¿ç§»
// è®¾è®¡æ€æƒ³ï¼šé¿å…æ‰©å®¹æ—¶çš„æ€§èƒ½æŠ–åŠ¨
// é¢è¯•é‡ç‚¹ï¼š
// 1. å¢é‡æ‰©å®¹çš„å®ç°
// 2. æ‰©å®¹è¿›åº¦çš„è·Ÿè¸ª
// 3. æ€§èƒ½ä¼˜åŒ–çš„æ•ˆæœ
```

## 4. æ ¸å¿ƒæœºåˆ¶è¯¦è§£

### 4.1 å“ˆå¸Œç®—æ³•
```
å“ˆå¸Œè®¡ç®—æµç¨‹ï¼š
key -> hash(key + hash0) -> é«˜8ä½(tophash) + ä½Bä½(æ¡¶ç´¢å¼•)
```

**æ ¸å¿ƒæµç¨‹ï¼š**
1. **å“ˆå¸Œè®¡ç®—**ï¼šä½¿ç”¨keyå’Œhash0è®¡ç®—å“ˆå¸Œå€¼
2. **æ¡¶ç´¢å¼•**ï¼šå–å“ˆå¸Œå€¼ä½Bä½ä½œä¸ºæ¡¶ç´¢å¼•
3. **å¿«é€Ÿæ¯”è¾ƒ**ï¼šä½¿ç”¨é«˜8ä½è¿›è¡Œå¿«é€Ÿæ¯”è¾ƒ
4. **å†²çªå¤„ç†**ï¼šä½¿ç”¨åˆ†ç¦»å¼é“¾è¡¨æ³•å¤„ç†å†²çª

### 4.2 æŸ¥æ‰¾æœºåˆ¶
```
æŸ¥æ‰¾æµç¨‹ï¼š
hash(key) -> æ¡¶ç´¢å¼• -> éå†æ¡¶ -> æ¯”è¾ƒtophash -> æ¯”è¾ƒkey -> è¿”å›value
```

**æŸ¥æ‰¾è¿‡ç¨‹ï¼š**
1. **è®¡ç®—å“ˆå¸Œ**ï¼šå¯¹keyè¿›è¡Œå“ˆå¸Œè®¡ç®—
2. **å®šä½æ¡¶**ï¼šæ ¹æ®å“ˆå¸Œå€¼å®šä½åˆ°å…·ä½“æ¡¶
3. **éå†æ¯”è¾ƒ**ï¼šéå†æ¡¶ä¸­çš„tophashæ•°ç»„
4. **ç²¾ç¡®åŒ¹é…**ï¼šæ‰¾åˆ°åŒ¹é…çš„tophashåæ¯”è¾ƒkey
5. **è¿”å›ç»“æœ**ï¼šè¿”å›å¯¹åº”çš„value

### 4.3 æ’å…¥æœºåˆ¶
```
æ’å…¥æµç¨‹ï¼š
æŸ¥æ‰¾ä½ç½® -> æ£€æŸ¥å®¹é‡ -> æ’å…¥æ•°æ® -> æ›´æ–°è®¡æ•° -> æ£€æŸ¥æ‰©å®¹
```

**æ’å…¥è¿‡ç¨‹ï¼š**
1. **æŸ¥æ‰¾ä½ç½®**ï¼šæŸ¥æ‰¾keyæ˜¯å¦å·²å­˜åœ¨
2. **å®¹é‡æ£€æŸ¥**ï¼šæ£€æŸ¥æ¡¶æ˜¯å¦æœ‰ç©ºä½
3. **æ•°æ®æ’å…¥**ï¼šåœ¨åˆé€‚ä½ç½®æ’å…¥key-value
4. **è®¡æ•°æ›´æ–°**ï¼šæ›´æ–°countå­—æ®µ
5. **æ‰©å®¹æ£€æŸ¥**ï¼šæ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹

### 4.4 æ‰©å®¹æœºåˆ¶
```
æ‰©å®¹è§¦å‘æ¡ä»¶ï¼š
count > 2^B * 6.5 (è´Ÿè½½å› å­çº¦ä¸º6.5)
```

**æ‰©å®¹æµç¨‹ï¼š**
1. **è§¦å‘æ¡ä»¶**ï¼šå…ƒç´ æ•°é‡è¶…è¿‡é˜ˆå€¼
2. **åˆ†é…æ–°æ¡¶**ï¼šåˆ†é…2^(B+1)ä¸ªæ–°æ¡¶
3. **å¢é‡è¿ç§»**ï¼šé€æ­¥è¿ç§»æ—§æ¡¶æ•°æ®
4. **æ›´æ–°æŒ‡é’ˆ**ï¼šè¿ç§»å®Œæˆååˆ‡æ¢bucketsæŒ‡é’ˆ
5. **æ¸…ç†æ—§æ¡¶**ï¼šé‡Šæ”¾æ—§æ¡¶å†…å­˜

### 4.5 åˆ é™¤æœºåˆ¶
```
åˆ é™¤æµç¨‹ï¼š
æŸ¥æ‰¾key -> æ ‡è®°åˆ é™¤ -> æ›´æ–°è®¡æ•° -> æ¸…ç†æº¢å‡ºæ¡¶
```

**åˆ é™¤è¿‡ç¨‹ï¼š**
1. **æŸ¥æ‰¾key**ï¼šå®šä½åˆ°è¦åˆ é™¤çš„å…ƒç´ 
2. **æ ‡è®°åˆ é™¤**ï¼šå°†tophashæ ‡è®°ä¸ºemptyOneæˆ–emptyRest
3. **è®¡æ•°æ›´æ–°**ï¼šå‡å°‘countè®¡æ•°
4. **æ¸…ç†ä¼˜åŒ–**ï¼šæ¸…ç†ç©ºçš„æº¢å‡ºæ¡¶

## 5. é¢è¯•è€ƒå¯Ÿç‚¹

### 5.1 åŸºç¡€æ¦‚å¿µé¢˜
**Q: Mapçš„åº•å±‚å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ**
A: 
- **å“ˆå¸Œè¡¨å®ç°**ï¼šåŸºäºhmapç»“æ„ä½“ï¼Œä½¿ç”¨åˆ†ç¦»å¼é“¾è¡¨æ³•å¤„ç†å†²çª
- **æ¡¶ç»“æ„è®¾è®¡**ï¼šæ¯ä¸ªæ¡¶æœ€å¤š8ä¸ªå…ƒç´ ï¼Œä½¿ç”¨tophashå¿«é€Ÿæ¯”è¾ƒ
- **åŠ¨æ€æ‰©å®¹**ï¼šè´Ÿè½½å› å­è¶…è¿‡6.5æ—¶è§¦å‘æ‰©å®¹ï¼Œæ”¯æŒå¢é‡è¿ç§»
- **å†…å­˜ä¼˜åŒ–**ï¼šç´§å‡‘å­˜å‚¨ï¼Œå‡å°‘å†…å­˜è®¿é—®ï¼Œæé«˜ç¼“å­˜å‘½ä¸­ç‡

**Q: Mapçš„æŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ**
A: 
- **å¹³å‡æƒ…å†µ**ï¼šO(1)ï¼Œå“ˆå¸Œè¡¨çš„æ ‡å‡†æ€§èƒ½
- **æœ€åæƒ…å†µ**ï¼šO(n)ï¼Œæ‰€æœ‰å…ƒç´ å“ˆå¸Œåˆ°åŒä¸€ä¸ªæ¡¶
- **å½±å“å› ç´ **ï¼šå“ˆå¸Œå‡½æ•°è´¨é‡ã€è´Ÿè½½å› å­ã€æ•°æ®åˆ†å¸ƒ
- **ä¼˜åŒ–ç­–ç•¥**ï¼šå¥½çš„å“ˆå¸Œå‡½æ•°ã€åˆç†çš„æ‰©å®¹ç­–ç•¥

### 5.2 æ ¸å¿ƒæœºåˆ¶ç›¸å…³
**Q: Mapå¦‚ä½•å¤„ç†å“ˆå¸Œå†²çªï¼Ÿ**
A: 
- **åˆ†ç¦»å¼é“¾è¡¨æ³•**ï¼šå†²çªçš„å…ƒç´ å­˜å‚¨åœ¨æº¢å‡ºæ¡¶ä¸­
- **æ¡¶å†…å­˜å‚¨**ï¼šæ¯ä¸ªæ¡¶æœ€å¤š8ä¸ªå…ƒç´ ï¼Œä½¿ç”¨æ•°ç»„å­˜å‚¨
- **æº¢å‡ºæ¡¶é“¾æ¥**ï¼šè¶…è¿‡8ä¸ªå…ƒç´ æ—¶é“¾æ¥æº¢å‡ºæ¡¶
- **æ€§èƒ½è€ƒè™‘**ï¼šå‡å°‘é“¾è¡¨é•¿åº¦ï¼Œæé«˜æŸ¥æ‰¾æ•ˆç‡

**Q: Mapçš„æ‰©å®¹æœºåˆ¶æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ**
A: 
```go
// æ‰©å®¹è§¦å‘æ¡ä»¶
if count > 2^B * 6.5 {
    // è§¦å‘æ‰©å®¹
    newB := B + 1
    // åˆ†é…æ–°æ¡¶æ•°ç»„
    // å¢é‡è¿ç§»æ•°æ®
    // æ›´æ–°bucketsæŒ‡é’ˆ
}
```

### 5.3 å†…å­˜ç®¡ç†ç›¸å…³
**Q: Mapçš„å†…å­˜å¸ƒå±€æ˜¯æ€æ ·çš„ï¼Ÿ**
A: 
- **ç´§å‡‘å­˜å‚¨**ï¼škeyå’Œvalueåˆ†åˆ«å­˜å‚¨åœ¨æ•°ç»„ä¸­
- **tophashæ•°ç»„**ï¼š8ä¸ªuint8ï¼Œç”¨äºå¿«é€Ÿæ¯”è¾ƒ
- **å†…å­˜å¯¹é½**ï¼šè€ƒè™‘CPUç¼“å­˜è¡Œï¼Œä¼˜åŒ–è®¿é—®æ€§èƒ½
- **æº¢å‡ºæ¡¶ç®¡ç†**ï¼šä½¿ç”¨mapextraç®¡ç†æº¢å‡ºæ¡¶

**Q: Mapæ‰©å®¹æ—¶çš„å†…å­˜ç®¡ç†ç­–ç•¥ï¼Ÿ**
A: 
- **å¢é‡æ‰©å®¹**ï¼šé¿å…ä¸€æ¬¡æ€§å¤§å†…å­˜åˆ†é…
- **æ—§æ¡¶ä¿ç•™**ï¼šæ‰©å®¹è¿‡ç¨‹ä¸­ä¿ç•™æ—§æ¡¶æ•°æ®
- **æ¸è¿›è¿ç§»**ï¼šé€æ­¥è¿ç§»æ•°æ®åˆ°æ–°æ¡¶
- **å†…å­˜é‡Šæ”¾**ï¼šè¿ç§»å®Œæˆåé‡Šæ”¾æ—§æ¡¶

### 5.4 å¹¶å‘æ§åˆ¶ç›¸å…³
**Q: Mapä¸ºä»€ä¹ˆä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ**
A: 
- **æ— é”è®¾è®¡**ï¼šä¸ºäº†æé«˜æ€§èƒ½ï¼Œæ²¡æœ‰å†…ç½®é”æœºåˆ¶
- **å¹¶å‘ä¿®æ”¹**ï¼šå¤šä¸ªgoroutineåŒæ—¶ä¿®æ”¹ä¼šå¯¼è‡´æ•°æ®ç«äº‰
- **è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨sync.Mapæˆ–æ‰‹åŠ¨åŠ é”
- **æ€§èƒ½è€ƒè™‘**ï¼šé”ä¼šå½±å“å¹¶å‘æ€§èƒ½

**Q: å¦‚ä½•å®ç°Mapçš„çº¿ç¨‹å®‰å…¨ï¼Ÿ**
A: 
```go
// æ–¹æ¡ˆ1ï¼šä½¿ç”¨sync.Map
var m sync.Map

// æ–¹æ¡ˆ2ï¼šä½¿ç”¨äº’æ–¥é”
type SafeMap struct {
    sync.RWMutex
    data map[string]interface{}
}

// æ–¹æ¡ˆ3ï¼šä½¿ç”¨åˆ†ç‰‡é”
type ShardedMap struct {
    shards []*Shard
}
```

**Q: sync.Map vs æ™®é€šMapçš„å¯¹æ¯”ï¼Ÿ**
A: 
- **è®¾è®¡æ€æƒ³**ï¼šsync.Mapä¸“ä¸ºè¯»å¤šå†™å°‘åœºæ™¯è®¾è®¡ï¼Œä½¿ç”¨read+dirtyåŒmap
- **æ€§èƒ½ç‰¹ç‚¹**ï¼šè¯»æ“ä½œæ— é”ï¼Œå†™æ“ä½œæœ‰é”ï¼Œé€‚åˆè¯»å¤šå†™å°‘
- **å†…å­˜å¼€é”€**ï¼šæœ‰é¢å¤–çš„read mapå¼€é”€ï¼Œä½†å‡å°‘é”ç«äº‰
- **ä½¿ç”¨åœºæ™¯**ï¼šé«˜å¹¶å‘è¯»å¤šå†™å°‘åœºæ™¯ï¼Œå¦‚ç¼“å­˜ã€é…ç½®å­˜å‚¨
- **é™åˆ¶**ï¼šä¸æ”¯æŒlen()ã€rangeç­‰æ“ä½œï¼Œç±»å‹å®‰å…¨éœ€è¦é¢å¤–å¤„ç†

### 5.5 æ€§èƒ½ä¼˜åŒ–ç›¸å…³
**Q: Mapçš„æ€§èƒ½ç“¶é¢ˆåœ¨å“ªé‡Œï¼Ÿ**
A: 
- **å“ˆå¸Œå†²çª**ï¼šå†²çªè¿‡å¤šå¯¼è‡´é“¾è¡¨è¿‡é•¿
- **å†…å­˜åˆ†é…**ï¼šé¢‘ç¹æ‰©å®¹å¯¼è‡´å†…å­˜åˆ†é…
- **ç¼“å­˜æœªå‘½ä¸­**ï¼šæ•°æ®åˆ†å¸ƒä¸å‡åŒ€å½±å“ç¼“å­˜
- **å¹¶å‘ç«äº‰**ï¼šæ— é”è®¾è®¡åœ¨å¹¶å‘åœºæ™¯ä¸‹çš„é—®é¢˜

**Q: å¦‚ä½•ä¼˜åŒ–Mapçš„æ€§èƒ½ï¼Ÿ**
A: 
- **é¢„åˆ†é…å®¹é‡**ï¼šä½¿ç”¨make(map[K]V, size)é¢„åˆ†é…
- **åˆç†è´Ÿè½½å› å­**ï¼šé¿å…é¢‘ç¹æ‰©å®¹
- **ä½¿ç”¨sync.Map**ï¼šé«˜å¹¶å‘è¯»å¤šå†™å°‘åœºæ™¯
- **åˆ†ç‰‡è®¾è®¡**ï¼šå‡å°‘é”ç«äº‰

### 5.6 å®é™…é—®é¢˜
**Q: Map vs Sliceçš„æ€§èƒ½å¯¹æ¯”ï¼Ÿ**
A: 
- **æŸ¥æ‰¾æ€§èƒ½**ï¼šMap O(1) vs Slice O(n)
- **å†…å­˜å¼€é”€**ï¼šMapæœ‰å“ˆå¸Œè¡¨å¼€é”€ï¼ŒSliceæ›´ç´§å‡‘
- **é€‚ç”¨åœºæ™¯**ï¼šMapé€‚åˆæŸ¥æ‰¾ï¼ŒSliceé€‚åˆéå†
- **é€‰æ‹©åŸåˆ™**ï¼šæ ¹æ®ä½¿ç”¨åœºæ™¯é€‰æ‹©åˆé€‚çš„æ•°æ®ç»“æ„

**Q: å¦‚ä½•æ£€æµ‹Mapçš„å†…å­˜æ³„æ¼ï¼Ÿ**
A: 
- **ä½¿ç”¨pprof**ï¼šåˆ†æå†…å­˜ä½¿ç”¨æƒ…å†µ
- **æ£€æŸ¥æº¢å‡ºæ¡¶**ï¼šè¿‡å¤šçš„æº¢å‡ºæ¡¶å¯èƒ½è¡¨ç¤ºæ³„æ¼
- **ç›‘æ§æ‰©å®¹**ï¼šé¢‘ç¹æ‰©å®¹å¯èƒ½è¡¨ç¤ºé—®é¢˜
- **ä»£ç å®¡æŸ¥**ï¼šæ£€æŸ¥Mapçš„ä½¿ç”¨æ¨¡å¼

## 6. å®é™…åº”ç”¨åœºæ™¯

### 6.1 åŸºç¡€åº”ç”¨
**ç¼“å­˜å®ç°ï¼š**
```go
type Cache struct {
    data map[string]interface{}
    mu   sync.RWMutex
}

func (c *Cache) Get(key string) (interface{}, bool) {
    c.mu.RLock()
    defer c.mu.RUnlock()
    value, exists := c.data[key]
    return value, exists
}

func (c *Cache) Set(key string, value interface{}) {
    c.mu.Lock()
    defer c.mu.Unlock()
    c.data[key] = value
}
```

### 6.2 é«˜çº§åº”ç”¨
**è®¡æ•°å™¨ç»Ÿè®¡ï¼š**
```go
func countWords(text string) map[string]int {
    words := strings.Fields(text)
    counts := make(map[string]int, len(words))
    
    for _, word := range words {
        counts[word]++
    }
    
    return counts
}
```

### 6.3 æ€§èƒ½ä¼˜åŒ–
**åˆ†ç‰‡Mapå®ç°ï¼š**
```go
type ShardedMap struct {
    shards []*Shard
    size   int
}

type Shard struct {
    sync.RWMutex
    data map[string]interface{}
}

func (sm *ShardedMap) Get(key string) (interface{}, bool) {
    shard := sm.getShard(key)
    shard.RLock()
    defer shard.RUnlock()
    return shard.data[key]
}

func (sm *ShardedMap) getShard(key string) *Shard {
    hash := fnv.New32a()
    hash.Write([]byte(key))
    return sm.shards[hash.Sum32()%uint32(sm.size)]
}
```

### 6.4 è°ƒè¯•åˆ†æ
**Mapæ€§èƒ½åˆ†æï¼š**
```go
func analyzeMapPerformance(m map[string]int) {
    // åˆ†æMapçš„è´Ÿè½½å› å­
    loadFactor := float64(len(m)) / float64(1<<B)
    
    // åˆ†ææº¢å‡ºæ¡¶æ•°é‡
    overflowCount := noverflow
    
    // åˆ†ææ‰©å®¹æ¬¡æ•°
    // é€šè¿‡ç›‘æ§countå’ŒBçš„å…³ç³»
    
    fmt.Printf("è´Ÿè½½å› å­: %.2f\n", loadFactor)
    fmt.Printf("æº¢å‡ºæ¡¶æ•°é‡: %d\n", overflowCount)
}
```

## 7. æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 7.1 è®¾è®¡ä¼˜åŒ–
- **é¢„åˆ†é…å®¹é‡**ï¼šä½¿ç”¨make(map[K]V, size)é¢„åˆ†é…
- **åˆç†è´Ÿè½½å› å­**ï¼šé¿å…é¢‘ç¹æ‰©å®¹
- **é€‰æ‹©åˆé€‚é”®ç±»å‹**ï¼šä½¿ç”¨ç®€å•ç±»å‹ä½œä¸ºé”®
- **é¿å…é¢‘ç¹ä¿®æ”¹**ï¼šæ‰¹é‡æ“ä½œä¼˜äºé¢‘ç¹å°æ“ä½œ

### 7.2 å†…å­˜ä¼˜åŒ–
- **åŠæ—¶åˆ é™¤**ï¼šåˆ é™¤ä¸éœ€è¦çš„é”®å€¼å¯¹
- **é¿å…å†…å­˜æ³„æ¼**ï¼šæ³¨æ„å¾ªç¯å¼•ç”¨
- **ç›‘æ§å†…å­˜ä½¿ç”¨**ï¼šä½¿ç”¨pprofåˆ†æå†…å­˜
- **åˆç†æ‰©å®¹ç­–ç•¥**ï¼šé¿å…è¿‡åº¦æ‰©å®¹

### 7.3 å¹¶å‘ä¼˜åŒ–
- **ä½¿ç”¨sync.Map**ï¼šé«˜å¹¶å‘è¯»å¤šå†™å°‘åœºæ™¯
- **åˆ†ç‰‡è®¾è®¡**ï¼šå‡å°‘é”ç«äº‰
- **è¯»å†™åˆ†ç¦»**ï¼šä½¿ç”¨è¯»å†™é”ä¼˜åŒ–
- **é¿å…çƒ­ç‚¹**ï¼šå‡åŒ€åˆ†å¸ƒæ•°æ®

### 7.4 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥
- **ç®€ç­”**ï¼šé¢„åˆ†é…å®¹é‡é¿å…æ‰©å®¹ï¼Œä½¿ç”¨ç®€å•é”®ç±»å‹ï¼Œæ‰¹é‡æ“ä½œä¼˜äºé¢‘ç¹å°æ“ä½œã€‚ç›‘æ§è´Ÿè½½å› å­å’Œæº¢å‡ºæ¡¶æ•°é‡ã€‚
- **å…·ä½“åˆ†æ**ï¼šè¯¦è§ **7. æ€§èƒ½ä¼˜åŒ–å»ºè®®** ç« èŠ‚

### 7.5 sync.Map vs æ™®é€šMap
- **ç®€ç­”**ï¼šsync.Mapä¸“ä¸ºè¯»å¤šå†™å°‘åœºæ™¯è®¾è®¡ï¼Œè¯»æ“ä½œæ— é”ï¼Œå†™æ“ä½œæœ‰é”ã€‚é€‚åˆé«˜å¹¶å‘ç¼“å­˜åœºæ™¯ï¼Œä½†å†…å­˜å¼€é”€æ›´å¤§ï¼ŒåŠŸèƒ½é™åˆ¶æ›´å¤šã€‚
- **å…·ä½“åˆ†æ**ï¼šè¯¦è§ **5.4 å¹¶å‘æ§åˆ¶ç›¸å…³** ä¸­çš„ "sync.Map vs æ™®é€šMapçš„å¯¹æ¯”"

## 8. ğŸ¯ é¢è¯•è€ƒå¯Ÿæ±‡æ€»

### ğŸ“‹ æ ¸å¿ƒçŸ¥è¯†ç‚¹æ¸…å•

#### ğŸ”¥ å¿…è€ƒçŸ¥è¯†ç‚¹
1. **Mapåº•å±‚å®ç°**
   - **ç®€ç­”**ï¼šåŸºäºhmapç»“æ„ä½“å®ç°å“ˆå¸Œè¡¨ï¼Œä½¿ç”¨åˆ†ç¦»å¼é“¾è¡¨æ³•å¤„ç†å†²çªã€‚æ¯ä¸ªæ¡¶æœ€å¤š8ä¸ªå…ƒç´ ï¼Œä½¿ç”¨tophashå¿«é€Ÿæ¯”è¾ƒã€‚æ”¯æŒåŠ¨æ€æ‰©å®¹å’Œå¢é‡è¿ç§»ã€‚
   - **å…·ä½“åˆ†æ**ï¼šè¯¦è§ **2.1 hmapç»“æ„ä½“ - æ ¸å¿ƒå®šä¹‰** ç« èŠ‚

2. **å“ˆå¸Œå†²çªå¤„ç†**
   - **ç®€ç­”**ï¼šä½¿ç”¨åˆ†ç¦»å¼é“¾è¡¨æ³•ï¼Œå†²çªå…ƒç´ å­˜å‚¨åœ¨æº¢å‡ºæ¡¶ä¸­ã€‚æ¯ä¸ªæ¡¶æœ€å¤š8ä¸ªå…ƒç´ ï¼Œè¶…è¿‡æ—¶é“¾æ¥æº¢å‡ºæ¡¶ã€‚é€šè¿‡tophashå¿«é€Ÿè¿‡æ»¤ï¼Œå‡å°‘æ¯”è¾ƒæ¬¡æ•°ã€‚
   - **å…·ä½“åˆ†æ**ï¼šè¯¦è§ **4.1 å“ˆå¸Œç®—æ³•** ç« èŠ‚

3. **æ‰©å®¹æœºåˆ¶**
   - **ç®€ç­”**ï¼šè´Ÿè½½å› å­è¶…è¿‡6.5æ—¶è§¦å‘æ‰©å®¹ï¼Œå®¹é‡ç¿»å€ã€‚ä½¿ç”¨å¢é‡æ‰©å®¹ï¼Œé€æ­¥è¿ç§»æ•°æ®ï¼Œé¿å…æ€§èƒ½æŠ–åŠ¨ã€‚æ‰©å®¹è¿‡ç¨‹ä¸­æ”¯æŒæ­£å¸¸è®¿é—®ã€‚
   - **å…·ä½“åˆ†æ**ï¼šè¯¦è§ **4.4 æ‰©å®¹æœºåˆ¶** ç« èŠ‚

4. **å¹¶å‘å®‰å…¨æ€§**
   - **ç®€ç­”**ï¼šMapä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ— å†…ç½®é”æœºåˆ¶ã€‚å¹¶å‘ä¿®æ”¹ä¼šå¯¼è‡´æ•°æ®ç«äº‰ã€‚è§£å†³æ–¹æ¡ˆåŒ…æ‹¬sync.Mapã€æ‰‹åŠ¨åŠ é”ã€åˆ†ç‰‡è®¾è®¡ã€‚
   - **å…·ä½“åˆ†æ**ï¼šè¯¦è§ **5.4 å¹¶å‘æ§åˆ¶ç›¸å…³** ç« èŠ‚

5. **æ€§èƒ½ç‰¹ç‚¹**
   - **ç®€ç­”**ï¼šå¹³å‡æŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦O(1)ï¼Œæœ€åæƒ…å†µO(n)ã€‚å†…å­˜ç´§å‡‘å­˜å‚¨ï¼Œä¼˜åŒ–ç¼“å­˜å‘½ä¸­ç‡ã€‚æ”¯æŒé¢„åˆ†é…å®¹é‡ï¼Œé¿å…é¢‘ç¹æ‰©å®¹ã€‚
   - **å…·ä½“åˆ†æ**ï¼šè¯¦è§ **5.5 æ€§èƒ½ä¼˜åŒ–ç›¸å…³** ç« èŠ‚

#### ğŸ”¥ é«˜é¢‘è€ƒç‚¹
1. **Map vs Sliceå¯¹æ¯”**
   - **ç®€ç­”**ï¼šMapæä¾›O(1)æŸ¥æ‰¾ï¼Œé€‚åˆé”®å€¼å¯¹åœºæ™¯ï¼›Sliceæä¾›O(n)æŸ¥æ‰¾ï¼Œé€‚åˆç´¢å¼•è®¿é—®ã€‚Mapæœ‰å“ˆå¸Œè¡¨å¼€é”€ï¼ŒSliceå†…å­˜æ›´ç´§å‡‘ã€‚æ ¹æ®ä½¿ç”¨åœºæ™¯é€‰æ‹©ã€‚
   - **å…·ä½“åˆ†æ**ï¼šè¯¦è§ **5.6 å®é™…é—®é¢˜** ä¸­çš„ "Map vs Sliceçš„æ€§èƒ½å¯¹æ¯”"

2. **å†…å­˜å¸ƒå±€ä¼˜åŒ–**
   - **ç®€ç­”**ï¼šä½¿ç”¨ç´§å‡‘å­˜å‚¨ï¼Œkeyå’Œvalueåˆ†åˆ«å­˜å‚¨åœ¨æ•°ç»„ä¸­ã€‚tophashæ•°ç»„ç”¨äºå¿«é€Ÿæ¯”è¾ƒï¼Œå‡å°‘å†…å­˜è®¿é—®ã€‚è€ƒè™‘CPUç¼“å­˜è¡Œå¯¹é½ã€‚
   - **å…·ä½“åˆ†æ**ï¼šè¯¦è§ **2.2 bmapç»“æ„ä½“ - æ¡¶ç»“æ„** ç« èŠ‚

3. **è´Ÿè½½å› å­è®¾è®¡**
   - **ç®€ç­”**ï¼šè´Ÿè½½å› å­ä¸º6.5ï¼Œå¹³è¡¡ç©ºé—´åˆ©ç”¨ç‡å’ŒæŸ¥æ‰¾æ€§èƒ½ã€‚è¿‡é«˜å¯¼è‡´å†²çªå¢å¤šï¼Œè¿‡ä½æµªè´¹å†…å­˜ã€‚æ‰©å®¹æ—¶ç¿»å€å¢é•¿ã€‚
   - **å…·ä½“åˆ†æ**ï¼šè¯¦è§ **4.4 æ‰©å®¹æœºåˆ¶** ç« èŠ‚

4. **å¢é‡æ‰©å®¹å®ç°**
   - **ç®€ç­”**ï¼šæ‰©å®¹æ—¶ä¿ç•™æ—§æ¡¶ï¼Œé€æ­¥è¿ç§»æ•°æ®åˆ°æ–°æ¡¶ã€‚æ”¯æŒæ‰©å®¹è¿‡ç¨‹ä¸­çš„æ­£å¸¸è®¿é—®ã€‚è¿ç§»å®Œæˆååˆ‡æ¢æŒ‡é’ˆï¼Œé‡Šæ”¾æ—§æ¡¶ã€‚
   - **å…·ä½“åˆ†æ**ï¼šè¯¦è§ **3.2 ğŸ”¥ å†…å­˜ç®¡ç†å­—æ®µ** ä¸­çš„ `oldbuckets` éƒ¨åˆ†

5. **æ€§èƒ½ä¼˜åŒ–ç­–ç•¥**
   - **ç®€ç­”**ï¼šé¢„åˆ†é…å®¹é‡é¿å…æ‰©å®¹ï¼Œä½¿ç”¨ç®€å•é”®ç±»å‹ï¼Œæ‰¹é‡æ“ä½œä¼˜äºé¢‘ç¹å°æ“ä½œã€‚ç›‘æ§è´Ÿè½½å› å­å’Œæº¢å‡ºæ¡¶æ•°é‡ã€‚
   - **å…·ä½“åˆ†æ**ï¼šè¯¦è§ **7. æ€§èƒ½ä¼˜åŒ–å»ºè®®** ç« èŠ‚

6. **sync.Map vs æ™®é€šMap**
   - **ç®€ç­”**ï¼šsync.Mapä¸“ä¸ºè¯»å¤šå†™å°‘åœºæ™¯è®¾è®¡ï¼Œè¯»æ“ä½œæ— é”ï¼Œå†™æ“ä½œæœ‰é”ã€‚é€‚åˆé«˜å¹¶å‘ç¼“å­˜åœºæ™¯ï¼Œä½†å†…å­˜å¼€é”€æ›´å¤§ï¼ŒåŠŸèƒ½é™åˆ¶æ›´å¤šã€‚
   - **å…·ä½“åˆ†æ**ï¼šè¯¦è§ **5.4 å¹¶å‘æ§åˆ¶ç›¸å…³** ä¸­çš„ "sync.Map vs æ™®é€šMapçš„å¯¹æ¯”"

#### ğŸ”¥ å®é™…é—®é¢˜
1. **Mapå†…å­˜æ³„æ¼**
   - **ç®€ç­”**ï¼šå¸¸è§åŸå› åŒ…æ‹¬å¾ªç¯å¼•ç”¨ã€æœªåˆ é™¤é”®å€¼å¯¹ã€æº¢å‡ºæ¡¶è¿‡å¤šã€‚ä½¿ç”¨pprofåˆ†æå†…å­˜ï¼Œæ£€æŸ¥Mapä½¿ç”¨æ¨¡å¼ï¼ŒåŠæ—¶æ¸…ç†ã€‚
   - **å…·ä½“åˆ†æ**ï¼šè¯¦è§ **5.6 å®é™…é—®é¢˜** ä¸­çš„ "å¦‚ä½•æ£€æµ‹Mapçš„å†…å­˜æ³„æ¼"

2. **é«˜å¹¶å‘åœºæ™¯ä¼˜åŒ–**
   - **ç®€ç­”**ï¼šä½¿ç”¨sync.Mapæ›¿ä»£æ™®é€šMapï¼Œå®ç°åˆ†ç‰‡è®¾è®¡å‡å°‘é”ç«äº‰ï¼Œè¯»å†™åˆ†ç¦»ä¼˜åŒ–æ€§èƒ½ã€‚é¿å…çƒ­ç‚¹æ•°æ®ã€‚
   - **å…·ä½“åˆ†æ**ï¼šè¯¦è§ **6.3 æ€§èƒ½ä¼˜åŒ–** ä¸­çš„åˆ†ç‰‡Mapå®ç°ç¤ºä¾‹

3. **Mapæ€§èƒ½è°ƒä¼˜**
   - **ç®€ç­”**ï¼šé¢„åˆ†é…åˆç†å®¹é‡ï¼Œé€‰æ‹©åˆé€‚é”®ç±»å‹ï¼Œç›‘æ§è´Ÿè½½å› å­ã€‚ä½¿ç”¨pprofåˆ†ææ€§èƒ½ç“¶é¢ˆï¼Œä¼˜åŒ–å“ˆå¸Œå‡½æ•°ã€‚
   - **å…·ä½“åˆ†æ**ï¼šè¯¦è§ **6.4 è°ƒè¯•åˆ†æ** ä¸­çš„æ€§èƒ½åˆ†æç¤ºä¾‹

4. **çº¿ç¨‹å®‰å…¨å®ç°**
   - **ç®€ç­”**ï¼šä½¿ç”¨sync.Mapã€äº’æ–¥é”åŒ…è£…ã€åˆ†ç‰‡é”è®¾è®¡ã€‚æ ¹æ®è¯»å†™æ¯”ä¾‹é€‰æ‹©åˆé€‚æ–¹æ¡ˆã€‚é¿å…é”ç«äº‰ã€‚
   - **å…·ä½“åˆ†æ**ï¼šè¯¦è§ **5.4 å¹¶å‘æ§åˆ¶ç›¸å…³** ä¸­çš„çº¿ç¨‹å®‰å…¨å®ç°ç¤ºä¾‹

5. **å“ˆå¸Œå‡½æ•°é€‰æ‹©**
   - **ç®€ç­”**ï¼šGoå†…ç½®å“ˆå¸Œå‡½æ•°è´¨é‡è‰¯å¥½ï¼Œæ”¯æŒè‡ªå®šä¹‰å“ˆå¸Œå‡½æ•°ã€‚è€ƒè™‘é”®çš„åˆ†å¸ƒç‰¹æ€§ï¼Œé¿å…å“ˆå¸Œæ”»å‡»ã€‚
   - **å…·ä½“åˆ†æ**ï¼šè¯¦è§ **3.2 ğŸ”¥ å†…å­˜ç®¡ç†å­—æ®µ** ä¸­çš„ `hash0` éƒ¨åˆ†

### ğŸ“ é¢è¯•ç­”é¢˜æ¨¡æ¿

#### æ¦‚å¿µè§£é‡Šç±»ï¼ˆ5æ­¥æ³•ï¼‰
1. **å®šä¹‰**ï¼šMapæ˜¯ä»€ä¹ˆï¼Œæ ¸å¿ƒä½œç”¨
2. **ç‰¹ç‚¹**ï¼šä¸»è¦ç‰¹æ€§å’Œä¼˜åŠ¿
3. **åŸç†**ï¼šåº•å±‚å®ç°æœºåˆ¶
4. **å¯¹æ¯”**ï¼šä¸å…¶ä»–æ•°æ®ç»“æ„çš„å¯¹æ¯”
5. **åº”ç”¨**ï¼šå®é™…ä½¿ç”¨åœºæ™¯

#### é—®é¢˜åˆ†æç±»ï¼ˆ5æ­¥æ³•ï¼‰
1. **ç°è±¡**ï¼šé—®é¢˜çš„å…·ä½“è¡¨ç°
2. **åŸå› **ï¼šé—®é¢˜çš„æ ¹æœ¬åŸå› 
3. **å½±å“**ï¼šé—®é¢˜å¸¦æ¥çš„å½±å“
4. **è§£å†³**ï¼šå…·ä½“çš„è§£å†³æ–¹æ¡ˆ
5. **é¢„é˜²**ï¼šå¦‚ä½•é¢„é˜²ç±»ä¼¼é—®é¢˜

#### è®¾è®¡å®ç°ç±»ï¼ˆ5æ­¥æ³•ï¼‰
1. **éœ€æ±‚**ï¼šåŠŸèƒ½éœ€æ±‚åˆ†æ
2. **è®¾è®¡**ï¼šæ¶æ„è®¾è®¡æ€è·¯
3. **å®ç°**ï¼šå…·ä½“å®ç°æ–¹æ¡ˆ
4. **ä¼˜åŒ–**ï¼šæ€§èƒ½ä¼˜åŒ–è€ƒè™‘
5. **æµ‹è¯•**ï¼šæµ‹è¯•å’ŒéªŒè¯æ–¹æ³•

### ğŸ¯ é¢è¯•é‡ç‚¹æé†’

#### å¿…é¡»æŒæ¡çš„æ ¸å¿ƒå­—æ®µ
- `count`ï¼šå…ƒç´ è®¡æ•°ï¼Œæ‰©å®¹è§¦å‘æ¡ä»¶
- `B`ï¼šæ¡¶æ•°é‡æŒ‡æ•°ï¼Œå®¹é‡ä¸º2^B * 8
- `buckets`ï¼šæ¡¶æ•°ç»„æŒ‡é’ˆï¼Œå½“å‰ä½¿ç”¨çš„æ¡¶
- `hash0`ï¼šå“ˆå¸Œç§å­ï¼Œé˜²æ­¢å“ˆå¸Œæ”»å‡»
- `oldbuckets`ï¼šæ—§æ¡¶æ•°ç»„ï¼Œå¢é‡æ‰©å®¹æ”¯æŒ
- `nevacuate`ï¼šæ‰©å®¹è¿›åº¦ï¼Œå¢é‡è¿ç§»è·Ÿè¸ª

#### å¿…é¡»ç†è§£çš„è®¾è®¡æ€æƒ³
- **åˆ†ç¦»å¼é“¾è¡¨æ³•**ï¼šå“ˆå¸Œå†²çªå¤„ç†ï¼Œæº¢å‡ºæ¡¶é“¾æ¥
- **ç´§å‡‘å­˜å‚¨**ï¼šå†…å­˜å¸ƒå±€ä¼˜åŒ–ï¼Œç¼“å­˜å‘½ä¸­ç‡
- **å¢é‡æ‰©å®¹**ï¼šé¿å…æ€§èƒ½æŠ–åŠ¨ï¼Œæ¸è¿›å¼è¿ç§»
- **è´Ÿè½½å› å­**ï¼šç©ºé—´åˆ©ç”¨ç‡vsæŸ¥æ‰¾æ€§èƒ½å¹³è¡¡
- **æ— é”è®¾è®¡**ï¼šæ€§èƒ½ä¼˜å…ˆï¼Œå¹¶å‘å®‰å…¨éœ€é¢å¤–å¤„ç†

#### å¿…é¡»å‡†å¤‡çš„å®é™…æ¡ˆä¾‹
- **ç¼“å­˜å®ç°**ï¼šçº¿ç¨‹å®‰å…¨çš„Mapç¼“å­˜
- **è®¡æ•°å™¨ç»Ÿè®¡**ï¼šè¯é¢‘ç»Ÿè®¡ç­‰åº”ç”¨
- **åˆ†ç‰‡Map**ï¼šé«˜å¹¶å‘åœºæ™¯çš„ä¼˜åŒ–
- **æ€§èƒ½åˆ†æ**ï¼šMapæ€§èƒ½ç“¶é¢ˆæ£€æµ‹
- **å†…å­˜æ³„æ¼**ï¼šMapå†…å­˜é—®é¢˜æ’æŸ¥
- **å¹¶å‘å®‰å…¨**ï¼šçº¿ç¨‹å®‰å…¨Mapçš„å®ç°

### ğŸ“š å¤ä¹ å»ºè®®

#### ç†è®ºå­¦ä¹ 
1. **æ·±å…¥ç†è§£å“ˆå¸Œè¡¨**ï¼šå“ˆå¸Œå‡½æ•°ã€å†²çªå¤„ç†ã€æ‰©å®¹æœºåˆ¶
2. **æŒæ¡å†…å­˜å¸ƒå±€**ï¼šç´§å‡‘å­˜å‚¨ã€ç¼“å­˜ä¼˜åŒ–ã€å†…å­˜å¯¹é½
3. **ç†è§£å¹¶å‘æ¨¡å‹**ï¼šæ— é”è®¾è®¡ã€çº¿ç¨‹å®‰å…¨ã€æ€§èƒ½æƒè¡¡

#### å®è·µç»ƒä¹ 
1. **å®ç°ç®€å•Map**ï¼šç†è§£åŸºæœ¬æ“ä½œå’Œæ‰©å®¹æœºåˆ¶
2. **æ€§èƒ½æµ‹è¯•**ï¼šå¯¹æ¯”ä¸åŒåœºæ™¯ä¸‹çš„æ€§èƒ½è¡¨ç°
3. **å¹¶å‘æµ‹è¯•**ï¼šéªŒè¯çº¿ç¨‹å®‰å…¨æ€§å’Œæ€§èƒ½å½±å“

#### é¢è¯•å‡†å¤‡
1. **å‡†å¤‡æ ‡å‡†ç­”æ¡ˆ**ï¼šå¸¸è§é—®é¢˜çš„æ ‡å‡†å›ç­”
2. **å‡†å¤‡å®é™…æ¡ˆä¾‹**ï¼šå®é™…é¡¹ç›®ä¸­çš„ä½¿ç”¨ç»éªŒ
3. **å‡†å¤‡ä¼˜åŒ–æ–¹æ¡ˆ**ï¼šæ€§èƒ½ä¼˜åŒ–çš„å…·ä½“æªæ–½

#### æŒç»­å­¦ä¹ 
1. **å…³æ³¨Goç‰ˆæœ¬æ›´æ–°**ï¼šMapç›¸å…³çš„æ–°ç‰¹æ€§
2. **å­¦ä¹ æœ€ä½³å®è·µ**ï¼šç¤¾åŒºä¸­çš„Mapä½¿ç”¨ç»éªŒ
3. **å®è·µé¡¹ç›®åº”ç”¨**ï¼šåœ¨å®é™…é¡¹ç›®ä¸­åº”ç”¨Map 